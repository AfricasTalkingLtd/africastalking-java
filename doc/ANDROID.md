# Africa's Talking

[ ![Download](https://api.bintray.com/packages/africastalking/java/com.africastalking/images/download.svg) ](https://bintray.com/africastalking/java/com.africastalking/_latestVersion)

We recommend using the library in a client/server setup to avoid hard-coding the username and API key into the distributed APK. In this setup, a client class on Android would call and execute remote methods on a server (could be a `java` web app, a` nodejs` app or even a `C/C++` application).

For security purposes, the client needs a token to authenticate with the server. This token should be generated by the server on login (or whenever/however your app authenticates its users). For additional security, the server can be setup `TLS/SSL` encryption.

## Download

Downloadable .jars can be found on the [GitHub download page](releases).
You can also depend on the .jar through Maven (from `http://dl.bintray.com/africastalking/java`):

```xml
<dependency>
  <groupId>com.africastalking</groupId>
  <artifactId>server</artifactId>
  <version>VERSION</version>
</dependency>
```

or Gradle:

```groovy
repositories {
  maven {
    url  "http://dl.bintray.com/africastalking/java"
  }
}

dependencies{
  // Client only
  compile 'com.africastalking:client:VERSION'
  
  // Server only
  compile 'com.africastalking:server:VERSION'
  
}
```



## Usage 

```java
/* On The Client (Android) */

public class SomeActivity extends Activity {

    public String some_login_function(username, password) {
      	// Receive token from server app...
      	return some_function_that_submits(username, password);
    }

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(args)
        setContentView(R.layout.some_activity);

        // 1. Get auth token 
        String token = some_login_function("usr", "pwd");

        // 2. Initialize client with your server's configs + token
        ATClient.initialize(HOST, PORT, token);

        // 3. Use the library e.g. e.g. send sms
        SMS sms = ATClient.getSmsService();
        sms.send("Hello There!", new String[] {"+2547xxxxxx"}, new Callback<String>() {
            @Override
             public void onSuccess(String response) {
                 Log.d(response); // json or xml depending on how you setup the server
             }

             @Override
             public void onFailure(Throwable throwable) {
                 Log.e(throwable.getMessage());
             }
        });
    }
}




/* On The Server (Java, Node.js, PHP, C/C++, C# and all languages supported by protobuf.) */

public class SomeJavaApplication {

    public static void main(String[] args) {

        // 1. Initialize the server
        ATServer mATServer = new ATServer(PORT, "USERNAME", "API_KEY");

        // 2. Start the server
        mATServer.start();


        get("/", (req, res) -> Render("Home"));

        get("/account", (req, res) -> Render("Account"));

        post("/login", (req, res) -> {
            //... Verify username, password
          	//...

          	// Generate client token...
            String token = mATServer.generateToken();
          	// Send token to client app...
          	res.send(token);
        });

        post("/logout", (req, res) -> {
          	//... End user session
          	// ...

            // Revoke their token...
            String token = req.body.get("token");
            mATServer.revokeToken(token)
        });
    }
}
```

See [example](../example/) for more usage examples.



## Initialization

The following static methods are available on the `ATClient` class to initialize the library:

\- `initialize(HOST, POST, TOKEN)`: Initialize the library.

\- `getXXXService()`: Get an instance to a given `XXX` service. e.g. `ATClient.getAccountService()`, `ATClient.getSmsService()`, etc.

The server `new ATServer(PORT, USERNAME, API_KEY)`…….. 

## Services

All methods return a `String` of `xml` or `json` data based on the specified format. All methods are synchronous (i.e. will block current thread) but provide asynchronous variants that take a `Callback<String>` as the last argument.

### `Account`

- `getUser()`: Get user information.

### `Airtime`

- `send(String phone, float amount)`: Send airtime to a phone number.
- `send(HashMap<String,Float> recipients)`: Send airtime to a bunch of phone numbers. The keys in the `recipients` map are phone numbers while the values are aitrime amounts.

For more information about status notification, please read [http://docs.africastalking.com/airtime/callback](http://docs.africastalking.com/airtime/callback)

### `SMS`

- `send(String message, String[] recipients)`: Send a message
- `sendBulk(String message, String[] recipients)`: Send a message in bulk
- `sendPremium(String message, String keyword, String linkId, String[] recipients)`: Send a premium SMS
- `fetchMessage()`: Fetch your messages
- `fetchSubscription(String shortCode, String keyword)`: Fetch your premium subscription data
- `createSubscription(String shortCode, String keyword, String phoneNumber)`: Create a premium subscription

For more information on: 

- How to receive SMS: [http://docs.africastalking.com/sms/callback](http://docs.africastalking.com/sms/callback)
- How to get notified of delivery reports: [http://docs.africastalking.com/sms/deliveryreports](http://docs.africastalking.com/sms/deliveryreports)
- How to listen for subscription notifications: [http://docs.africastalking.com/subscriptions/callback](http://docs.africastalking.com/subscriptions/callback)

### `Payment`

- `checkout(String productName, String phoneNumber, float amount, Currency currency)`: Initiate mobile checkout.
- `payConsumers(String productName, List<Consumer> recipients)`: Send money to consumer. 
- `payBusiness(String productName, Business recipient)`: Send money to business.

For more information, please read [http://docs.africastalking.com/payments